# Template file for 'cargo-bootstrap'
pkgname=cargo-bootstrap
version=1.60.0
revision=1
short_desc="Bootstrap binaries of Rust package manager"
maintainer="q66 <daniel@octaforge.org>"
license="MIT, Apache-2.0"
homepage="https://www.rust-lang.org/"
conflicts="cargo>=0"
lib32disabled=yes
nostrip=yes

_bootstrap_url="https://static.rust-lang.org/dist"

# we don't use upstream cargo binaries for ppc32, as they are busted (probably
# a dependency is wrong, which results in failed signature verification when
# updating the crates.io index)
case "$XBPS_TARGET_MACHINE" in
	x86_64*|i686|ppc64le) ;;
	*) _bootstrap_url="https://alpha.de.repo.voidlinux.org/distfiles" ;;
esac

wrksrc="cargo-${version}-${RUST_TARGET}"
distfiles="${_bootstrap_url}/cargo-${version}-${RUST_TARGET}.tar.xz"

case "$XBPS_TARGET_MACHINE" in
	i686)
		checksum="8490d9c772120f25ccd443cf11f7ecc2837d176737fe5399014c96802d279d47"
		;;
	x86_64)
		checksum="48edb2eb51d7c56ef9a3130f0b331e83f139559161f6f93b9588d28cf72610f3"
		;;
	x86_64-musl)
		checksum="38268edfebb190192f895134c73824ac9b017fa937510be4b35be17364ad05e4"
		;;
	ppc64le)
		checksum="ed7a75ec1af8ce187ce2fecc8ddb38b1979416eeb832c319526c85458a0e4564"
		;;
	ppc64le-musl)
		checksum="badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadb"
		;;
	ppc64)
		checksum="e48d98130f79858a3d969d1af95314ae46ba91a3cc20dcbd408412368643bd45"
		;;
	ppc)
		checksum="04baf8303fab197e3643270fd93eb42eb9e7f44fced98406fa5a43373684f0db"
		;;
	*) broken="cargo bootstrap binaries unavailable for ${XBPS_MACHINE}";;
esac

do_install() {
	vbin cargo/bin/cargo
	vlicense LICENSE-APACHE
	vlicense LICENSE-MIT
	vlicense LICENSE-THIRD-PARTY
}
