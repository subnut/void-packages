# Template file for 'cargo-bootstrap'
pkgname=cargo-bootstrap
version=1.59.0
revision=1
short_desc="Bootstrap binaries of Rust package manager"
maintainer="q66 <daniel@octaforge.org>"
license="MIT, Apache-2.0"
homepage="https://www.rust-lang.org/"
conflicts="cargo>=0"
lib32disabled=yes
nostrip=yes

_bootstrap_url="https://static.rust-lang.org/dist"

# we don't use upstream cargo binaries for ppc32, as they are busted (probably
# a dependency is wrong, which results in failed signature verification when
# updating the crates.io index)
case "$XBPS_TARGET_MACHINE" in
	x86_64*|i686|ppc64le) ;;
	*) _bootstrap_url="https://alpha.de.repo.voidlinux.org/distfiles" ;;
esac

wrksrc="cargo-${version}-${RUST_TARGET}"
distfiles="${_bootstrap_url}/cargo-${version}-${RUST_TARGET}.tar.xz"

case "$XBPS_TARGET_MACHINE" in
	i686)
		checksum="4f282b8a4dadf53ba3f8784cefe0c2be908179ba81b7b29a0db4a11b6a3f8849"
		;;
	x86_64)
		checksum="f56ebfb333ea46e4429377bf4b16a2ec889d61640a41c3093577cdd8f3c80b96"
		;;
	x86_64-musl)
		checksum="95f2727f22f40d7a294f08d24dc7b5f4fb4fe3991854becceffa75bf8f049745"
		;;
	ppc64le)
		checksum="fdab44481286db3ea8f4b6d409e648355009ef458188352d5e2c5799f7614fbd"
		;;
	ppc64le-musl)
		checksum="f2b7e87c5f7fbab96c008374049ba1019c3503cf3c5b7742e536375c2a11f584"
		;;
	ppc64)
		checksum="8535bc99aa88daa8f7fc001a9a7588f1d024a8d2aa38462532745d5327233cae"
		;;
	ppc)
		checksum="377942d80eade23684a2dc4fa89782e782ae7f90038b7d56bf1bb48afc822c8f"
		;;
	*) broken="cargo bootstrap binaries unavailable for ${XBPS_MACHINE}";;
esac

do_install() {
	vbin cargo/bin/cargo
	vlicense LICENSE-APACHE
	vlicense LICENSE-MIT
	vlicense LICENSE-THIRD-PARTY
}
