# Template file for 'rust-bootstrap'
pkgname=rust-bootstrap
version=1.60.0
revision=1
create_wrksrc=yes
short_desc="Rust programming language bootstrap toolchain"
maintainer="q66 <daniel@octaforge.org>"
license="MIT, Apache-2.0"
homepage="https://www.rust-lang.org/"
conflicts="rust>=0"
lib32disabled=yes
nostrip=yes

if [ "$XBPS_TARGET_LIBC" = "musl" ]; then
	depends="libexecinfo-devel"
fi

_bootstrap_url="https://static.rust-lang.org/dist"

case "$XBPS_MACHINE" in
	x86_64*|i686|ppc64le|ppc) ;;
	*) _bootstrap_url="https://alpha.de.repo.voidlinux.org/distfiles";;
esac

distfiles="
 ${_bootstrap_url}/rustc-${version}-${RUST_TARGET}.tar.xz
 ${_bootstrap_url}/rust-std-${version}-${RUST_TARGET}.tar.xz"

case "$XBPS_TARGET_MACHINE" in
	i686)
		checksum="
		 202b2ea1ce8981990996d3ffd6d8f94737e714fa448c0691a3fd738b74ec43df
		 04a7ed0ab0811e3d4dc86053af1d49a8654bfdd6a1a5c22419e8a2c42c33c382"
		;;
	x86_64)
		checksum="
		 fc0b41c15e348ad0eeb7a6c015a922a2ac95e9577e531635558b26d99399f315
		 6fb8ee3650beb10836ae48a9aaa535473e64eaca20695b88113267aea3c7557f"
		;;
	x86_64-musl)
		checksum="
		 0b8b5261575575bae6768a27fcd43b01784ee7e29249ca8fd7b1d3b5e1fab5a9
		 0801252694e49eca069003f311e23e124a6dee3557e613133dc2e3cab7bed64d"
		;;
	ppc64le)
		checksum="
		 6647cfa1f27ddeb444157fd84bd8d9229b9d2c39226a607e4017845023dd9fd2
		 3bfce36ef03027574f2f1e17d24b172bd086a0a3adbd8944955d18ad9919a78e"
		;;
	ppc64le-musl)
		checksum="
		 badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadb
		 badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadb"
		;;
	ppc64)
		checksum="
		 44c97180c4c99ba80af5638ec34cefef9e25c67f0061f1c784847e81c9812125
		 b390bec6ce697a6347fb6c5dd70bb23f562cc9945ed215f10fd08dbc1a38293f"
		;;
	ppc)
		checksum="
		 988c8e5f1926b1329d41c742134aa9e62b250b08af4a46a6ef3184d7ad518a4f
		 81138f4b9c8ec6f68fa81f10ec0da5962a7bb433a85009fe970ec3bb6596b1af"
		;;
	*) broken="rust bootstrap binaries unavailable for ${XBPS_MACHINE}";;
esac

do_install() {
	for d in *; do
		cd $d
		./install.sh --prefix=/usr --destdir="${DESTDIR}"
		cd ..
	done

	vlicense rustc-${version}-${RUST_TARGET}/COPYRIGHT
	vlicense rustc-${version}-${RUST_TARGET}/LICENSE-APACHE
	vlicense rustc-${version}-${RUST_TARGET}/LICENSE-MIT

	rm -f ${DESTDIR}/usr/lib/rustlib/${RUST_TARGET}/bin/rust-ll*
}
