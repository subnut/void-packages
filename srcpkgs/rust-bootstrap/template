# Template file for 'rust-bootstrap'
pkgname=rust-bootstrap
version=1.59.0
revision=1
create_wrksrc=yes
short_desc="Rust programming language bootstrap toolchain"
maintainer="q66 <daniel@octaforge.org>"
license="MIT, Apache-2.0"
homepage="https://www.rust-lang.org/"
conflicts="rust>=0"
lib32disabled=yes
nostrip=yes

if [ "$XBPS_TARGET_LIBC" = "musl" ]; then
	depends="libexecinfo-devel"
fi

_bootstrap_url="https://static.rust-lang.org/dist"

case "$XBPS_MACHINE" in
	x86_64*|i686|ppc64le|ppc) ;;
	*) _bootstrap_url="https://alpha.de.repo.voidlinux.org/distfiles";;
esac

distfiles="
 ${_bootstrap_url}/rustc-${version}-${RUST_TARGET}.tar.xz
 ${_bootstrap_url}/rust-std-${version}-${RUST_TARGET}.tar.xz"

case "$XBPS_TARGET_MACHINE" in
	i686)
		checksum="
		 47f5702e5cc3414585e60d572bfeca85cd6d834d6705b509de1d4c8285b02a3a
		 26e91818a36184998039aeaabbf0972a8610d0d250e4bc03de6f27a7843971b5"
		;;
	x86_64)
		checksum="
		 838de1fef855ef7733a87862c2575e8da9f3fa11fd0a8ce05c293038ea92356e
		 c854a9ee3dd8e5be9522c1581f75838c1cbae6dece3934b0004f138c4a5024a3"
		;;
	x86_64-musl)
		checksum="
		 e0b543b36f8b3471975e5982f7c93894947af315932dd3305d1cf5763c4f5d4e
		 473b6ddf598418db49efc21c3d2702cdaf9c78ee4ae00611c7d9e384a2d4dad7"
		;;
	ppc64le)
		checksum="
		 e5458f55e51f8baecab4ff1e43fae5c6e1c40d8171098ab633747ee0684b37bb
		 15dee7705967e3351aff11c64ada30c4957b54066c7ee49b87be4b8155bd0a7d"
		;;
	ppc64le-musl)
		checksum="
		 f2b7e87c5f7fbab96c008374049ba1019c3503cf3c5b7742e536375c2a11f584
		 f2b7e87c5f7fbab96c008374049ba1019c3503cf3c5b7742e536375c2a11f584"
		;;
	ppc64)
		checksum="
		 22380d50ca30793e00e4688bcc06180b7ce3e2badeae8320a2aae25f65966f52
		 1217290e951ae84998d2d04a88d154b1da205e2638a3449c02c8e9256bff589c"
		;;
	ppc)
		checksum="
		 fe847f49ad4afa42858e6f712da3c7d8a3e502d9104eed84db440fdc53cc6f96
		 5ead471b53d290960d49a7cec0ba01a082f5e6cfa18825366990d46797dc7161"
		;;
	*) broken="rust bootstrap binaries unavailable for ${XBPS_MACHINE}";;
esac

do_install() {
	for d in *; do
		cd $d
		./install.sh --prefix=/usr --destdir="${DESTDIR}"
		cd ..
	done

	vlicense rustc-${version}-${RUST_TARGET}/COPYRIGHT
	vlicense rustc-${version}-${RUST_TARGET}/LICENSE-APACHE
	vlicense rustc-${version}-${RUST_TARGET}/LICENSE-MIT

	rm -f ${DESTDIR}/usr/lib/rustlib/${RUST_TARGET}/bin/rust-ll*
}
